<html><head><title>CELLBASE</title><style type="text/css">ol{margin:0;padding:0}.c0{padding-top:0pt;direction:ltr;padding-bottom:0pt}.c12{max-width:486pt;background-color:#ffffff;padding:30pt 37.5pt 30pt 37.5pt}.c6{color:#1155cc;text-decoration:underline}.c9{font-size:18pt;font-weight:bold}.c5{color:inherit;text-decoration:inherit}.c8{padding-top:24pt;padding-bottom:6pt}.c1{font-size:12pt}.c4{margin-left:18pt}.c3{height:10pt}.c2{direction:ltr}.c11{font-size:14pt}.c10{font-weight:bold}.c7{text-indent:36pt}.title{padding-top:24pt;line-height:1.0;text-align:left;color:#000000;font-size:36pt;background-color:#ffffff;font-family:"Verdana";font-weight:bold;padding-bottom:6pt}.subtitle{padding-top:18pt;line-height:1.0;text-align:left;color:#666666;font-style:italic;font-size:24pt;background-color:#ffffff;font-family:"Georgia";padding-bottom:4pt}li{color:#000000;font-size:10pt;background-color:#ffffff;font-family:"Verdana"}p{color:#000000;font-size:10pt;background-color:#ffffff;margin:0;font-family:"Verdana"}h1{padding-top:12pt;line-height:1.0;text-align:left;color:#000000;font-size:18pt;background-color:#ffffff;font-family:"Verdana";font-weight:bold;padding-bottom:12pt}h2{padding-top:11.2pt;line-height:1.0;text-align:left;color:#000000;font-size:14pt;background-color:#ffffff;font-family:"Verdana";font-weight:bold;padding-bottom:11.2pt}h3{padding-top:12pt;line-height:1.0;text-align:left;color:#000000;font-size:12pt;background-color:#ffffff;font-family:"Verdana";font-weight:bold;padding-bottom:12pt}h4{padding-top:12.8pt;line-height:1.0;text-align:left;color:#000000;font-size:10pt;background-color:#ffffff;font-family:"Verdana";font-weight:bold;padding-bottom:12.8pt}h5{padding-top:12.8pt;line-height:1.0;text-align:left;color:#000000;font-size:8pt;background-color:#ffffff;font-family:"Verdana";font-weight:bold;padding-bottom:12.8pt}h6{padding-top:18pt;line-height:1.0;text-align:left;color:#000000;font-size:8pt;background-color:#ffffff;font-family:"Verdana";font-weight:bold;padding-bottom:18pt}</style></head><body class="c12"><p class="c0 c3"><span class="c9"></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.31mt2t4q9qeg">4/26/12, BH: timestamp conversion</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.d2fexak9r6ot">5/3/12, BH: update findanalysis.m</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.re9smmx0gl3q">5/3/12, BH: update listtag.m and findcellpos.m</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.fkw2kgbk5jnb">5/3/12, BH: rewrite insertdata.m</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.f2ibj6nvvxe3">5/3/12, BH: TheMatrix is a cell!</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.bzr9imr6j3ne">5/3/12, BH: listcell.m cleanup</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.k1spqfd1hs6p">5/4/12, BH: maintain compatibility (findprop.m, getvalue.m)</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.3lxwrz1lrhl">5/4/12, BH: abs2reltimes.m and rel2abstimes.m</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.naaj4ymg1vnh">5/4/12, BH: iscellid.m</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.kahflnvmrog2">5/7/12, BH: set_subplots.m</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.ubte9b8g4liq">5/7/12, BH: plotwaveforms.m</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.aau1x5apyprx">5/8/12, BH: update extractSegSpikes.m</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.q0j8du3d8q8k">5/8/12, BH, SPR: plot_mclust_projections2.m</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.c1xolvoyldme">5/9/12, BH: check_channel_validity.m</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.d2ngxq2plv1r">5/9/12, BH: lightcluster.m</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.8bjt5l2230ie">5/10/12, BH: prealignSpikes.m</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.up79fk479nkx">5/10/12, BH: rel2abstimes.m</a></span></p><p class="c2 c4"><span class="c6"><a class="c5" href="#h.txycmb9nkksp">6/21/12, BH: new option for prealignSpikes.m: replace an event</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.jh1juhfm1h33">6/21/12, BH: delanalysis.m cleanup</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.flxh7xahuy7c">6/26/12, BH: fixing addcell.m</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.ypqa97o5updj">7/5/12.BH: ultimate_psth.m</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.fmlrrv8clct">7/5/12, BH: selecttrial.m refurbished, added as option to filterTrials.m</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.cs87bfay0za5">7/6/12, BH: addnewsessions obsolete</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.wk1604hkcm1j">7/6/12, BH: cellid2vals.m</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.8zzzg2bzlmul">7/6/12, BH: loadcb.m, findcell.m, selectcell.m cleanup</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.46n5gu4ovzku">7/6/12, BH: defineEventsEpochs_default, defineEventsEpochs_agonogo, defineEventsEpochs_pulseon</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.x7h6n81p01zr">7/6/12, BH: checkcb.m, checkcb2.m</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.v8kp5g97vb0u">8/3/12, BH: ultimate_psth.m upgrade</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.pkwxmxf2rhye">8/12/12, BH: ultimate_psth.m upgrade #2</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.l3b2zo3hzs6f">8/21/12, BH: new functionality for selectcell.m</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.bqq49lu85vwb">9/4/12, BH: partition_trials.m fix</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.6lttin89qs11">9/25/12, BH: parseTTLs.m</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.d20rdp3n0ix0">10/25/12, BH: findSegs2.m bugfix</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.gvlhd4vfo4l7">11/2/12, BH: addanalysis.m and delanalysis.m saves backup</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.drm7z59lnje9">11/2/12, BH: reorganizing, documentation</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.7ti8o4m2exnk">11/7/12, SR: viewpopselectivity2a.m plot analyses from multiple cell groups.</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.db8mt98sct78">11/7/12, SR: setmyplot.m: added functionality.</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.1j07j68if8d2">11/9/12, BH: findSegs3.m</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.3op3y7mzie3l">12/6/12, BH: addanalysis bug fix</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.kvwj3muczqa4">1/28/13, BH: helper functions</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.hcmj1b8u3nmw">3/28/13, BH: formatforExcel</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.9hrlddarksp7">4/2/13, BH: MakeStimEvents2</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.bbn6ajpx3fev">4/15/13, BH: plot functions</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.dx9lvtxd9px1">4/16/13, BH: setvalue.m</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.3dvfsm2mvtv7">4/23/13, BH: addnewcells.m improved</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.642dub9zh523">5/16/13, BH: addanalysis.m</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.upue33nq3f55">5/20/13. BH: ultimate_psth.m</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.6cqsivmpnd5z">5/20/13, BH: addanysis, addcell upgrade</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.y5cykclw4219">7/15/13, BH: findstimperiod.m</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.j73hf71xx9dt">7/15/13, BH: psth_stats.m</a></span></p><p class="c4 c2"><span class="c6"><a class="c5" href="#h.kp5ldhjmxwq6">7/18/13, BH: formatforExcel.m</a></span></p><p class="c3 c2"><span class="c9"></span></p><p class="c0 c3"><span class="c9"></span></p><p class="c0 c3"><span class="c9"></span></p><h1 class="c8 c2"><a name="h.31mt2t4q9qeg"></a><span>4/26/12, BH: timestamp conversion</span></h1><p class="c0"><span class="c1">time stamp of TT... mat files will reflect the original Ntt file</span></p><p class="c0"><span class="c1">timestamps are converted in loadcb every time the TT...mat file is loaded</span></p><p class="c0"><span class="c1">no other conversion is needed, unless the original Ntt files are loaded</span></p><p class="c0"><span class="c1">behavior timestamps remain in seconds</span></p><p class="c0"><span class="c1">no need to edit MClust</span></p><p class="c0 c3"><span class="c1"></span></p><h1 class="c8 c2"><a name="h.d2fexak9r6ot"></a><span>5/3/12, BH: update findanalysis.m</span></h1><p class="c0"><span class="c1">two output arguments: first=position in TheMatrix (column index),</span></p><p class="c0"><span class="c1">second=index in ANALYSIS</span></p><p class="c0 c3"><span class="c1"></span></p><h1 class="c2 c8"><a name="h.re9smmx0gl3q"></a><span>5/3/12, BH: update listtag.m and findcellpos.m</span></h1><p class="c0"><span class="c1">do justice to mice: now they accept &lsquo;animal&rsquo; as an alternative of &lsquo;rat&rsquo;</span></p><p class="c0 c3"><span class="c1"></span></p><h1 class="c8 c2"><a name="h.fkw2kgbk5jnb"></a><span>5/3/12, BH: rewrite insertdata.m</span></h1><p class="c0"><span class="c1">kept former functionalities for compatibility</span></p><p class="c0"><span class="c1">flexible calling, input handling with inputParser</span></p><p class="c0"><span class="c1">analysis results can also be inserted, not only properties</span></p><p class="c0"><span class="c1">can overwrite previous data</span></p><p class="c0"><span class="c1">saves a backup before writing new cellbase file</span></p><p class="c0"><span class="c1">documentation of the new version:</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">%INSERTDATA &nbsp; Inserts data into CellBase directly.</span></p><p class="c0"><span class="c1">% &nbsp; NF = INSERTDATA(DATA,PARAM,VALUE) inserts DATA into TheMatrix</span></p><p class="c0"><span class="c1">% &nbsp; and ANALYSES (see CellBase documentation). It optionally returns the</span></p><p class="c0"><span class="c1">% &nbsp; list of entries in DATA which did not provide a match with CELLIDLIST</span></p><p class="c0"><span class="c1">% &nbsp; (NF).</span></p><p class="c0"><span class="c1">% &nbsp; Input arguments:</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;DATA - Either a Matlab variable or a full pathname to a .mat or an</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Excel file. It can optionally contain a header row with</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;property_names&#39; in the first column and corresponding property</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;names for data columns. First column should contain cellIDs. If</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;property names are added as both input argument and data</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;header, the user is forced to choose which one to use.</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;TYPE&#39;, T - Parameter indicating whether an analysis or a set of</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;properties are added. T should start with the letter &#39;a&#39; or &#39;p&#39;</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;accordingly.</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;NAME&#39;, NM - Name of the analysis or properti(es). For analysis:</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;it should be the name of a valid m file. For properties: either</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;a character array (one property) or a cell array of strings</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(multiple properties).</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;INPUT_ARGUMENTS&#39;, LS1 - Input arguments for analysis, cell array.</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;OUTPUT_ARGUMENTS&#39;, LS2 - Names of output arguments for analysis,</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;cell array of strings. This determines the property names when</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;an analysis is added.</span></p><p class="c0"><span class="c1">%</span></p><p class="c0"><span class="c1">% &nbsp; The number of properties or output arguments (in case of adding values</span></p><p class="c0"><span class="c1">% &nbsp; to an analysis) must match the number of data columns (number of all</span></p><p class="c0"><span class="c1">% &nbsp; columns minus one) in DATA.</span></p><p class="c0"><span class="c1">%</span></p><p class="c0"><span class="c1">% &nbsp; Missing input arguments are asked for interactively. If DATA is empty,</span></p><p class="c0"><span class="c1">% &nbsp; the user has to browse for the data file. If &#39;Cancel&#39; is selected for</span></p><p class="c0"><span class="c1">% &nbsp; browsing result, data values will interactively be prompted for</span></p><p class="c0"><span class="c1">% &nbsp; according to a selected tag type (animal, session, tetrode or cell).</span></p><p class="c0"><span class="c1">%</span></p><p class="c0"><span class="c1">% &nbsp; If a property or an analysis is already added to CellBase, the user is</span></p><p class="c0"><span class="c1">% &nbsp; asked whether to overwrite previous data. An analysis is only</span></p><p class="c0"><span class="c1">% &nbsp; considered the same if the name of the m file and both the list of</span></p><p class="c0"><span class="c1">% &nbsp; input and output arguments are the same. If the data is overwritten,</span></p><p class="c0"><span class="c1">% &nbsp; the timestamp property in ANALYSES is updated.</span></p><p class="c0"><span class="c1">%</span></p><p class="c0"><span class="c1">% &nbsp; New data is inserted into TheMatrix and ANALYSES according to the</span></p><p class="c0"><span class="c1">% &nbsp; corresponding cellIDs. A backup of the previous cellbase file is stored</span></p><p class="c0"><span class="c1">% &nbsp; before overwriting.</span></p><p class="c0"><span class="c1">%</span></p><p class="c0"><span class="c1">% &nbsp; Examples:</span></p><p class="c0"><span class="c1">% &nbsp; insertdata(data,&#39;type&#39;,&#39;analysis&#39;,&#39;name&#39;,&#39;LRatio&#39;,&#39;input_arguments&#39;,...</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{{&#39;Amplitude&#39;,&#39;Energy&#39;}},&#39;output_arguments&#39;,{&#39;ID_amp&#39;,&#39;Lr_amp&#39;})</span></p><p class="c0"><span class="c1">% &nbsp; not_found = insertdata([],&#39;type&#39;,&#39;prop&#39;,&#39;name&#39;,&#39;validity&#39;);</span></p><p class="c0"><span class="c1">%</span></p><p class="c0"><span class="c1">% &nbsp; See also ADDANALYSIS and RUNANALYSIS.</span></p><p class="c0 c3"><span class="c1"></span></p><h1 class="c8 c2"><a name="h.f2ibj6nvvxe3"></a><span>5/3/12, BH: TheMatrix is a cell!</span></h1><p class="c0"><span class="c11">i</span><span class="c1">nsertdata is compatible with both the cell and the double version; for double, new data columns are initialized with NaNs to avoid filling with zeros (cells pad with NaN by default!)</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">addanalysis: modified to deal with both cases; real test is going to be when I add a new cell to the CellBase</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">addcell: same</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">what&rsquo;s left: delcell, delanalysis, exportdata, getvalue</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">listcell works, but output is now a cell - may give some problems, but it&rsquo;s only called from example_analysis and new_example_analysis1</span></p><p class="c0 c3"><span class="c1"></span></p><h1 class="c8 c2"><a name="h.bzr9imr6j3ne"></a><span>5/3/12, BH: listcell.m cleanup</span></h1><p class="c0"><span class="c1">help added, variables initialized, comments added, &lsquo;smart indent&rsquo;</span></p><p class="c0 c3"><span class="c1"></span></p><h1 class="c8 c2"><a name="h.k1spqfd1hs6p"></a><span>5/4/12, BH: maintain compatibility (findprop.m, getvalue.m)</span></h1><p class="c0"><span class="c1">edit findprop.m and getvalue.m to maintain compatibility with updated findanalysis.m and cell version of TheMatrix</span></p><p class="c0"><span class="c1">findprop cleanup, helps and comments added, loads only ANALYSES from CellBase (loading TheMatrix is slow and unnecessary in this case)</span></p><p class="c0"><span class="c1">getvalue: similar to runanalysis, returns double if conversion from cell is possible</span></p><p class="c0 c3"><span class="c1"></span></p><h1 class="c8 c2"><a name="h.3lxwrz1lrhl"></a><span>5/4/12, BH: abs2reltimes.m and rel2abstimes.m</span></h1><p class="c0"><span class="c1">conversion between absolute time stamps and time stamps relative to an event</span></p><p class="c0 c3"><span class="c1"></span></p><h1 class="c8 c2"><a name="h.naaj4ymg1vnh"></a><span>5/4/12, BH: iscellid.m</span></h1><p class="c0"><span class="c1">search in CELLIDLIST, return logical; calls validcellid with &lsquo;list&rsquo; option</span></p><p class="c0 c3"><span class="c1"></span></p><h1 class="c8 c2"><a name="h.kahflnvmrog2"></a><span>5/7/12, BH: set_subplots.m</span></h1><p class="c0"><span class="c1">cleanup, comments, help</span></p><p class="c0"><span class="c1">make it possible to call with axis property, value pairs </span></p><p class="c0 c3"><span class="c1"></span></p><h1 class="c8 c2"><a name="h.ubte9b8g4liq"></a><span>5/7/12, BH: plotwaveforms.m</span></h1><p class="c0"><span class="c1">function for plotting waveforms created:</span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">%PLOTWAVEFORMS &nbsp; Plot spontaneous and/or light-evoked spike shape.</span></p><p class="c0"><span class="c1">% &nbsp; PLOTWAVEFORMS(CELLID) plots the waveform of spontaneous and putative</span></p><p class="c0"><span class="c1">% &nbsp; light-evoked spikes. It finds the latency of putative light-evoked</span></p><p class="c0"><span class="c1">% &nbsp; spikes as peaks of firing rate after light pulses. The period for</span></p><p class="c0"><span class="c1">% &nbsp; putative light-evoked spikes is defined by half-hight crossings around</span></p><p class="c0"><span class="c1">% &nbsp; the peak (see FINDSTIMPERIOD for details). If there is no detectable</span></p><p class="c0"><span class="c1">% &nbsp; activation, 1 and 5 ms are used, which include typical latencies of</span></p><p class="c0"><span class="c1">% &nbsp; light-evoked spikes. Spontaneous spikes are extracted from 2 s periods</span></p><p class="c0"><span class="c1">% &nbsp; before light bursts. Only 2000 randomly chosen spikes are plotted. This</span></p><p class="c0"><span class="c1">% &nbsp; number can be changed using the &#39;MAXNUM&#39;, VALUE optional input</span></p><p class="c0"><span class="c1">% &nbsp; parameter-value pair.</span></p><p class="c0"><span class="c1">%</span></p><p class="c0"><span class="c1">% &nbsp; Two optional input parameter value pairs control whether to plot both</span></p><p class="c0"><span class="c1">% &nbsp; spontaneous and evoked waveforms or only one of those:</span></p><p class="c0"><span class="c1">% &nbsp; HS = PLOTWAVEFORMS(CELLID,&#39;SPONT&#39;,TRUE,&#39;EVOKED&#39;,TRUE) plots both</span></p><p class="c0"><span class="c1">% &nbsp; waveforms and a third plot to compare them. Setting either of the input</span></p><p class="c0"><span class="c1">% &nbsp; values to &#39;false&#39; will prevent plotting that type. Handles of the</span></p><p class="c0"><span class="c1">% &nbsp; resulting figures are returned in the output structure HS with the</span></p><p class="c0"><span class="c1">% &nbsp; following fieldnames: HS.H_spont for spontaneous waveforms, HS.H_evoked</span></p><p class="c0"><span class="c1">% &nbsp; for light-evoked waveforms and HS.H_compare for the compound figure.</span></p><p class="c0"><span class="c1">%</span></p><p class="c0"><span class="c1">% &nbsp; HS = PLOTWAVEFORMS(CELLID,&#39;CORRELATION&#39;,&#39;TRUE&#39;) also returns waveform</span></p><p class="c0"><span class="c1">% &nbsp; correlation for the largest channel (see NBSPIKESHAPECORR) in HS.R</span></p><p class="c0"><span class="c1">% &nbsp; field of the output structure.</span></p><p class="c0"><span class="c1">%</span></p><p class="c0"><span class="c1">% &nbsp; Optional input parameter-value paris with default values:</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;spont&#39;, true - plot spontaneous waveform</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;evoked&#39;, true - plot light-evoked waveform</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;maxnum&#39;, 2000 - maximum number of spikes to plot</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;correlation&#39;, false - return waveform correlation</span></p><p class="c0"><span class="c1">%</span></p><p class="c0"><span class="c1">% &nbsp; See also FINDISSTIMPERIOD, ABS2RELTIMES, EXTRACTSEGSPIKES,</span></p><p class="c0"><span class="c1">% &nbsp; EXTRACTSPIKEWAVEFORMS and NBSPIKESHAPECORR.</span></p><p class="c0 c3"><span class="c1"></span></p><h1 class="c8 c2"><a name="h.aau1x5apyprx"></a><span>5/8/12, BH: update extractSegSpikes.m</span></h1><p class="c0"><span class="c1">overload with numeric input as first input argument: spike times (e.g. all spikes on a tetrode) can be passed</span></p><p class="c0"><span class="c1">uses inputParser</span></p><p class="c0 c3"><span class="c1"></span></p><h1 class="c8 c2"><a name="h.q0j8du3d8q8k"></a><span>5/8/12, BH, SPR: plot_mclust_projections2.m</span></h1><p class="c0"><span class="c1">plot projections, tagged cluster in orange, light-evoked spikes superimposed in blue</span></p><p class="c0"><span class="c1">modified from plot_mclust_projections</span></p><p class="c0"><span class="c1">%PLOT_MCLUST_PROJECTIONS2 &nbsp; Plot feature data for clusters.</span></p><p class="c0"><span class="c1">% &nbsp; PLOT_MCLUST_PROJECTIONS2(CELLID) plots feature data for a tagged cell</span></p><p class="c0"><span class="c1">% &nbsp; (CELLID) and it&#39;s tetrode pairs in all projections. Tagged cluster is</span></p><p class="c0"><span class="c1">% &nbsp; shown in orange and light-evoked spikes are overlayed in blue. Time</span></p><p class="c0"><span class="c1">% &nbsp; period for light-evoked activity is selected automatically (see</span></p><p class="c0"><span class="c1">% &nbsp; FINDSTIMPERIOD). Only spikes from the beginning of the first to the end</span></p><p class="c0"><span class="c1">% &nbsp; of the last stimulation protocol are included. These default behaviors</span></p><p class="c0"><span class="c1">% &nbsp; can be modified using the following optional input arguments</span></p><p class="c0"><span class="c1">% &nbsp; (parameter, value pairs, with default values):</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;stim_period&#39;, [] - start and end of stimulation period after each</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;light pulse</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;feature_names&#39;, &#39;Energy&#39; - features for which feature data are</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plotted; character or cell array</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;marker_size&#39;, 1 - marker size for the scatter plots</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;usefastplot&#39;, true - use fast plotting method (downsample points</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;to plot only one point per pixel; appears the same); faster,</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;but zoom is not implemented (for saving in image formats, e.g.</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;pdf or jpg); if false, full data is plotted (for viewing or</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;saving fig format)</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;stimonly&#39;, true - only spikes from the beginning of the first to</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;the end of the last stimulation protocol are selected for</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;plotting; if false, all spikes are included</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;plotlightspikes&#39;, true - if true, light-evoked spikes are</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;superimposed</span></p><p class="c0"><span class="c1">%</span></p><p class="c0"><span class="c1">% &nbsp; See also PLOTWAVEFORMS.</span></p><p class="c0 c3"><span class="c1"></span></p><h1 class="c8 c2"><a name="h.c1xolvoyldme"></a><span>5/9/12, BH: check_channel_validity.m</span></h1><p class="c0"><span class="c1">outsourced from LRatio.m to form a separate function</span></p><p class="c0"><span class="c1">%CHECK_CHANNEL_VALIDITY &nbsp; Check tetrode channels.</span></p><p class="c0"><span class="c1">% &nbsp; VALID_CHANNELS = CHECK_CHANNEL_VALIDITY(CELLID) loads &#39;Energy&#39; property</span></p><p class="c0"><span class="c1">% &nbsp; for all spikes on tetrode of CELLID and returns a 1-by-4 logical array</span></p><p class="c0"><span class="c1">% &nbsp; that is true for the tetrode channels that have a mean Energy higher</span></p><p class="c0"><span class="c1">% &nbsp; than an empirically decided threshold value.</span></p><p class="c0"><span class="c1">%</span></p><p class="c0"><span class="c1">% &nbsp; See also LRATIO.</span></p><p class="c0 c3"><span class="c11"></span></p><h1 class="c8 c2"><a name="h.d2ngxq2plv1r"></a><span>5/9/12, BH: lightcluster.m</span></h1><p class="c0"><span class="c1">quantifying whether light-spikes are continuous with noise </span></p><p class="c0 c3"><span class="c1"></span></p><p class="c0"><span class="c1">%LIGHTCLUSTER &nbsp; Clustering of light-evoked spikes.</span></p><p class="c0"><span class="c1">% &nbsp; [D L] = LIGHTCLUSTER(CELLID) analyzes whether the light-evoked spikes</span></p><p class="c0"><span class="c1">% &nbsp; of a putative tagged cell (CELLID) are separated from other</span></p><p class="c0"><span class="c1">% &nbsp; light-evoked spikes. It returns cluster quality indices (Isolation</span></p><p class="c0"><span class="c1">% &nbsp; Distance, D; L-ratio, L) for the distance of light-evoked spikes of</span></p><p class="c0"><span class="c1">% &nbsp; CELLID compared with all light-evoked spikes (i.e. cluster quality</span></p><p class="c0"><span class="c1">% &nbsp; indices restricted to light-evoked spikes).</span></p><p class="c0"><span class="c1">%</span></p><p class="c0"><span class="c1">% &nbsp; [D L PREF] = LIGHTCLUSTER(CELLID) returns preferential occurrance of</span></p><p class="c0"><span class="c1">% &nbsp; light-evoked spikes in the tagged cluster (PREF).</span></p><p class="c0"><span class="c1">%</span></p><p class="c0"><span class="c1">% &nbsp; [D L PREF VALID_CHANNELS] = LIGHTCLUSTER(CELLID) also returns channel</span></p><p class="c0"><span class="c1">% &nbsp; validity.</span></p><p class="c0"><span class="c1">%</span></p><p class="c0"><span class="c1">% &nbsp; See also LRATIO.</span></p><p class="c0 c3"><span class="c1"></span></p><h1 class="c8 c2"><a name="h.8bjt5l2230ie"></a><span>5/10/12, BH: prealignSpikes.m</span></h1><p class="c0"><span class="c1">option to use with a custom events or epochs matrix and not a definition file fixed; </span></p><p class="c0"><span class="c1">input argument parsing with inputParser</span></p><p class="c0"><span class="c1">ifsave option fixed</span></p><p class="c0"><span class="c1">cleanup, help, comments added</span></p><p class="c0 c3"><span class="c1"></span></p><h1 class="c8 c2"><a name="h.up79fk479nkx"></a><span>5/10/12, BH: rel2abstimes.m</span></h1><p class="c0"><span class="c1">new option: call it with a cell, converts StimSpikes to abs time stamps</span></p><p class="c0 c3"><span class="c1"></span></p><h1 class="c0"><a name="h.txycmb9nkksp"></a><span>6/21/12, BH: new option for prealignSpikes.m: replace an event</span></h1><p class="c0"><span class="c1">an event can now be replaced with new data without deleting or recalculating previously added events</span></p><p class="c0"><span class="c1">a new input parameter called writing_behavior controls the now three options: overwrite the entire file, append to the file or replace preexisting events with new data</span></p><p class="c0"><span class="c1">ifappend input param. is kept for backwards compatibility, but writing_behavior takes precedence if specified</span></p><p class="c0 c3"><span class="c1"></span></p><h1 class="c0"><a name="h.jh1juhfm1h33"></a><span>6/21/12, BH: delanalysis.m cleanup</span></h1><p class="c0"><span class="c1">help added, comments added, indented</span></p><p class="c0 c3"><span class="c1"></span></p><h1 class="c0"><a name="h.flxh7xahuy7c"></a><span>6/26/12, BH: fixing addcell.m</span></h1><p class="c0"><span class="c1">addcell.m was bug fixed so that it can add analyses to TheMatrix when adding a new cell</span></p><p class="c0"><span class="c1">addnewcell.m and iscellid.m modified so that the new cell is also detected as a valid cellID</span></p><p class="c0 c3"><span class="c1"></span></p><h1 class="c0"><a name="h.ypqa97o5updj"></a><span>7/5/12.BH: ultimate_psth.m</span></h1><p class="c0"><span class="c1">new highlevel PSTH function with parseInput, many calling options</span></p><p class="c0"><span class="c1">calls adaptive or normal PSTH</span></p><p class="c0"><span class="c1">modular, fully cellbase-compatible</span></p><p class="c0"><span class="c1">documentation:</span></p><p class="c0"><span class="c1">%ULTIMATE_PSTH &nbsp; Peri-stimulus time histogram.</span></p><p class="c0"><span class="c1">% &nbsp; [PSTH SPSTH SPSTH_SE] = ULTIMATE_PSTH(CELLID,EVENT_TYPE,EVENT,WINDOW,VARARGIN)</span></p><p class="c0"><span class="c1">% &nbsp; calculates peri-stimulus time histogram (PSTH) for the cell passed in</span></p><p class="c0"><span class="c1">% &nbsp; CELLID. Smoothed PSTH (SPSTH) and SE of smoothing (SPSTH_SE) are also</span></p><p class="c0"><span class="c1">% &nbsp; returned.</span></p><p class="c0"><span class="c1">%</span></p><p class="c0"><span class="c1">% &nbsp; Mandatory input arguments:</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;CELLID: defines the cell (see CellBase documentation)</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EVENT: the event to which the PSTH is aligned</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;EVENT_TYPE: the type of event, &#39;stim&#39; or &#39;trial&#39;</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;WINDOW: window for calculation relative to the event in seconds</span></p><p class="c0"><span class="c1">%</span></p><p class="c0"><span class="c1">% &nbsp; Default behavior of ULTIMATE_PSTH can be modified by using a set of</span></p><p class="c0"><span class="c1">% &nbsp; paramter-value pairs as optional input parameters. The following</span></p><p class="c0"><span class="c1">% &nbsp; parameters are implemented (with default values):</span></p><p class="c0"><span class="c1">% &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; &#39;dt&#39;, 0.001 - time resolution in seconds</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;sigma&#39;, 0.02 - smoothing kernel for the smoothed PSTH, in seconds</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;margin&#39;,[-0.01 0.01] margins for PSTH calculation to get rid of</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;edge effect due to smoothing</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;event_filter&#39;, &#39;none&#39; - filter light-stimulation trials; see</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FILTERTRIALS for implemented filter types</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;filterinput&#39;,[] - some filters require additional input; see</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;FILTERTRIALS for details</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;maxtrialno&#39;, 5000 - maximal number of trials included; if ther are</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;more valid trials, they are randomly down-sampled</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;parts&#39;, &#39;all&#39; - partitioning the set of trials; input to</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PARTITION_TRIALS, see details therein (default, no</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;partitioning)</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&#39;isadaptive, true - if false, classic PSTH algorithm is applied; if</span></p><p class="c0"><span class="c1">% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;true, adaptive PSTH is calculated (see APSTH2)</span></p><p class="c0"><span class="c1">%</span></p><p class="c0"><span class="c1">% &nbsp; See also BINRASTER2PSTH, BINRASTER2APSTH, APSTH2, VIEWCELL2B,</span></p><p class="c0"><span class="c1">% &nbsp; PARTITION_TRIALS and FILTERTRIALS.</span></p><p class="c0 c3"><span class="c1"></span></p><h1 class="c0"><a name="h.fmlrrv8clct"></a><span>7/5/12, BH: selecttrial.m refurbished, added as option to filterTrials.m</span></h1><p class="c0"><span class="c1">selecttrial: cleanup, help, preallocation, bug fix (now works for elementary logical expression as well)</span></p><p class="c0"><span class="c1">filterTrials: a new option for filter named &lsquo;custom&rsquo; is added; filterinput is used for calling selecttrial within this &lsquo;custom&rsquo; filter</span></p><p class="c0 c3"><span class="c1"></span></p><h1 class="c0"><a name="h.cs87bfay0za5"></a><span>7/6/12, BH: addnewsessions obsolete</span></h1><p class="c0"><span class="c1">eliminated along with dependents</span></p><p class="c0 c3"><span class="c1"></span></p><h1 class="c0"><a name="h.wk1604hkcm1j"></a><span>7/6/12, BH: cellid2vals.m</span></h1><p class="c0"><span class="c1">cleanup, fixed: was based on some other naming convention, and datenum output never worked</span></p><p class="c0 c3"><span class="c1"></span></p><h1 class="c0"><a name="h.8zzzg2bzlmul"></a><span>7/6/12, BH: loadcb.m, findcell.m, selectcell.m cleanup</span></h1><p class="c0"><span class="c1">cleanup, </span><span class="c1">comments and help added</span></p><p class="c0 c3"><span class="c1"></span></p><h1 class="c0"><a name="h.46n5gu4ovzku"></a><span>7/6/12, BH: defineEventsEpochs_default, defineEventsEpochs_agonogo, defineEventsEpochs_pulseon</span></h1><p class="c0"><span class="c1">documentation and cleanup</span></p><p class="c0 c3"><span class="c1"></span></p><h1 class="c0"><a name="h.x7h6n81p01zr"></a><span>7/6/12, BH: checkcb.m, checkcb2.m</span></h1><p class="c0"><span class="c1">checkcb obsolete, deleted; checkcb2 renamed checkcb; help and comments added, cleaned</span></p><p class="c0 c3"><span class="c1"></span></p><h1 class="c0"><a name="h.v8kp5g97vb0u"></a><span>8/3/12, BH: ultimate_psth.m upgrade</span></h1><p class="c0"><span class="c1">proudly introduce &lsquo;doubly adaptive&rsquo; PSTH: window size is also adapting (stronger adaptation); <br>functions: dapsth.m, binraster2dapsth.m</span></p><p class="c0"><span class="c1">ultimate_psth can optionally call the &lsquo;doubly adaptive&rsquo; algorithm now</span></p><p class="c0 c3"><span class="c1"></span></p><h1 class="c2"><a name="h.pkwxmxf2rhye"></a><span>8/12/12, BH: ultimate_psth.m upgrade #2</span></h1><p class="c2"><span class="c1">ultimate_psth is now equipped with the option of testing for sign. firing rate changes after an event; psth_stats.m does this job</span></p><p class="c3 c2"><span class="c1"></span></p><h1 class="c2"><a name="h.l3b2zo3hzs6f"></a><span>8/21/12, BH: new functionality for selectcell.m</span></h1><p class="c2"><span class="c1">selectcell now supports logical operations on string properties, which exist since TheMatrix is now a cell</span></p><p class="c3 c2"><span class="c1"></span></p><p class="c2"><span class="c1">example:</span></p><p class="c2"><span class="c1">selstr = [&#39;&quot;PV+&quot;==1&amp;&quot;ID_PC&quot;&gt;20&amp;&quot;Lr_PC&quot;&lt;0.15&amp;&#39; ...</span></p><p class="c2"><span class="c1">&#39;ismember(&quot;Area1&quot;,{&#39;&#39;GP&#39;&#39;,&#39;&#39;GP/SI&#39;&#39;,&#39;&#39;SI&#39;&#39;,&#39;&#39;IC&#39;&#39;,&#39;&#39;RT/IC&#39;&#39;,&#39;&#39;EP&#39;&#39;,&#39;&#39;EA&#39;&#39;,&#39;&#39;EAC&#39;&#39;})&#39;];</span></p><p class="c2"><span class="c1">PV = selectcell(selstr);</span></p><p class="c3 c2"><span class="c1"></span></p><h1 class="c2"><a name="h.bqq49lu85vwb"></a><span>9/4/12, BH: partition_trials.m fix</span></h1><p class="c2"><span class="c1">NaN is not considered a separate partition now</span></p><p class="c3 c2"><span class="c1"></span></p><h1 class="c2"><a name="h.6lttin89qs11"></a><span>9/25/12, BH: parseTTLs.m</span></h1><p class="c2"><span class="c1">MakeTrialEvents_anogo (synchronization code between behav. and Neuralynx) now parses TTLs into binary numbers to treat the channels separately, so that superimposed TTLs do not pose a problem</span></p><p class="c2"><span class="c1">calls parseTTLs.m for this</span></p><p class="c3 c2"><span class="c1"></span></p><h1 class="c2"><a name="h.d20rdp3n0ix0"></a><span>10/25/12, BH: findSegs2.m bugfix</span></h1><p class="c2"><span class="c1">a bug which messed up including/excluding behavior segments for different input arguments has been fixed</span></p><p class="c3 c2"><span class="c1"></span></p><h1 class="c2"><a name="h.gvlhd4vfo4l7"></a><span>11/2/12, BH: addanalysis.m and delanalysis.m saves backup</span></h1><p class="c2"><span class="c1">these functions now save a timestamped backup of CellBase before overwriting, similar to delcell.m</span></p><p class="c3 c2"><span class="c1"></span></p><h1 class="c2"><a name="h.drm7z59lnje9"></a><span>11/2/12, BH: reorganizing, documentation</span></h1><p class="c2"><span class="c1">full html documentation for the database functions</span></p><p class="c2"><span class="c1">m files reorganized to folders and subfolders in a more systematic way</span></p><p class="c3 c2"><span class="c1"></span></p><h1 class="c2"><a name="h.7ti8o4m2exnk"></a><span>11</span><span>/7/12, SR: viewpopselectivity2a.m plot analyses from multiple cell groups.</span></h1><p class="c2"><span class="c1">This function plots a scatter plot of 2 analyses. 2 groups of cellids can be color coded in this plot. </span></p><p class="c0 c3"><span class="c1 c10"></span></p><h1 class="c2"><a name="h.db8mt98sct78"></a><span>11/7/12, SR: setmyplot.m: added functionality.</span></h1><p class="c2"><span class="c1">This version can check for Tags such as &lsquo;title&rsquo; and &lsquo;label&rsquo; and specify their FontSizes (or any other property) independently. This is possible only when passing a set of text handles as varargin. Need to specify &lsquo;Tag&rsquo; property for these handles in the code. For e.g. l(1) = xlabel(&lsquo;The appropriate X label&rsquo;,&rsquo;Tag&rsquo;,&rsquo;label&rsquo;). This version is compatible with earlier versions.</span></p><p class="c3 c2"><span class="c1"></span></p><h1 class="c2"><a name="h.1j07j68if8d2"></a><span>11/9/12, BH: findSegs3.m</span></h1><p class="c2"><span class="c1">a new version of findSegs that can handle missing stimulus or trial events</span></p><p class="c3 c2"><span class="c1"></span></p><h1 class="c2"><a name="h.3op3y7mzie3l"></a><span>12/6/12, BH: addanalysis bug fix</span></h1><p class="c2"><span class="c1">previously, analyses had to return output arguments in a cell</span></p><p class="c2"><span class="c1">this cumbersome syntax previously was eliminated</span></p><p class="c2"><span class="c1">now addanalysis.m is fixed to be compatible with regular syntax</span></p><p class="c2"><span class="c1">nargvout.m probably became obsolete</span></p><p class="c3 c2"><span class="c1"></span></p><h1 class="c2"><a name="h.kvwj3muczqa4"></a><span>1/28/13, BH: helper functions</span></h1><p class="c2"><span class="c1">help added, commenting, cleanup</span></p><p class="c3 c2"><span class="c1"></span></p><h1 class="c2"><a name="h.hcmj1b8u3nmw"></a><span>3/28/13, BH: formatforExcel</span></h1><p class="c2"><span class="c1">new helper function</span></p><p class="c2"><span class="c1">changes special numbers (like NaN) to strings for writing them to Excel</span></p><p class="c3 c2"><span class="c1"></span></p><h1 class="c2"><a name="h.9hrlddarksp7"></a><span>4/2/13, BH: MakeStimEvents2</span></h1><p class="c2"><span class="c1">major overhaul, protocol names as optional input arguments, inputParser, documentation</span></p><p class="c3 c2"><span class="c1"></span></p><h1 class="c2"><a name="h.bbn6ajpx3fev"></a><span>4/15/13, BH: plot functions</span></h1><p class="c2"><span class="c1">plot functions restructured</span></p><p class="c2"><span class="c1">help files</span></p><p class="c2"><span class="c1">documentation</span></p><p class="c3 c2"><span class="c1"></span></p><h1 class="c2"><a name="h.dx9lvtxd9px1"></a><span>4/16/13, BH: setvalue.m</span></h1><p class="c2"><span class="c1">New function!</span></p><p class="c2"><span class="c1">setvalue(cellid,property,value) sets a value in TheMatrix</span></p><p class="c2"><span class="c1">a timestamped backup of cellbase is saved before overwriting</span></p><p class="c2"><span class="c1">help:</span></p><p class="c2"><span>%SETVALUE &nbsp; Set value associated with a property.</span></p><p class="c2"><span>% &nbsp; STATUS = SETVALUE(CELLID,PROP,VALUE) sets a property (PROP) to a</span></p><p class="c2"><span>% &nbsp; specified value (VALUE) for a given cell (CELLID) in CellBase. If</span></p><p class="c2"><span>% &nbsp; editing TheMatrix is sucessful, STATUS = true is returned.</span></p><p class="c2"><span>%</span></p><p class="c2"><span>% &nbsp; See also GETVALUE.</span></p><p class="c3 c2"><span></span></p><h1 class="c2"><a name="h.3dvfsm2mvtv7"></a><span>4/23/13, BH: addnewcells.m improved</span></h1><p class="c2"><span class="c1">as a new input option, the directory in which new cells are located can be specified</span></p><p class="c2"><span class="c1">the call syntax has been changed and inputParser is used to parse input arguments</span></p><p class="c2"><span class="c1">findallcells.m has been modified to allow the new option</span></p><p class="c3 c2"><span></span></p><h1 class="c2"><a name="h.642dub9zh523"></a><span>5/16/13, BH: addanalysis.m</span></h1><p class="c2"><span class="c1">bugs fixed, cleaned, changed input argument handling to inputParser</span></p><p class="c3 c2"><span></span></p><h1 class="c2"><a name="h.upue33nq3f55"></a><span>5/20/13. BH: ultimate_psth.m</span></h1><p class="c2"><span class="c1">dynamic event definition added:</span></p><p class="c2"><span>EVENT: the event to which the PSTH is aligned; if EVENT is a cell</span></p><p class="c2"><span>% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;array of two strings, the first event is used for the PSTH</span></p><p class="c2"><span>% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;and binraster before 0 and the second event is used for the</span></p><p class="c2"><span>% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;PSTH and binraster after 0; if EVENT is a function handle, the</span></p><p class="c2"><span>% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;function is called for CELLID to define the aligning event</span></p><p class="c2"><span>% &nbsp; &nbsp; &nbsp; &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(dynamic event definition)</span></p><p class="c3 c2"><span></span></p><h1 class="c2"><a name="h.6cqsivmpnd5z"></a><span>5/20/13, BH: addanysis, addcell upgrade</span></h1><p class="c2"><span class="c1">MAJOR UPGRADE: addanalysis and addcell now handles analysis functions that has mandatory input arguments, not only parameter-value pairs; also, it is not a requirement any more that all output arguments be added to TheMatrix; an optional parameter-value pair to addanalysis controls which subset of output arguments are inserted</span></p><p class="c3 c2"><span class="c1"></span></p><p class="c2"><span>%ADDANALYSIS &nbsp; Add an analysis to CellBase.</span></p><p class="c2"><span>% &nbsp; ADDANALYSIS(FUNHANDLE) adds an analysis to CellBase with the specified</span></p><p class="c2"><span>% &nbsp; function handle. ADDANALYSIS also executes the analysis function passed</span></p><p class="c2"><span>% &nbsp; by FUNHANDLE on the cells included in CellBase. Note that the analysis</span></p><p class="c2"><span>% &nbsp; specified by FUNHANDLE should take a cell ID as its first input</span></p><p class="c2"><span>% &nbsp; argument.</span></p><p class="c2"><span>%</span></p><p class="c2"><span>% &nbsp; ADDANALYSIS(FUNHANDLE,&#39;PROPERTY_NAMES&#39;,PR) passes the list of property</span></p><p class="c2"><span>% &nbsp; names (PR, cell array of strings) to ADDANALYSIS. The property name</span></p><p class="c2"><span>% &nbsp; &#39;default&#39; is used if no property names are specified. The first N</span></p><p class="c2"><span>% &nbsp; outputs of the analysis function are used, where N is the number of</span></p><p class="c2"><span>% &nbsp; inserted properties (length of PR).</span></p><p class="c2"><span>%</span></p><p class="c2"><span>% &nbsp; ADDANALYSIS(FUNHANDLE,&#39;PROPERTY_NAMES&#39;,PR,&#39;OUTPUT_SUBSET&#39;,OS) passes</span></p><p class="c2"><span>% &nbsp; the list of property names (PR, cell array of strings) to ADDANALYSIS.</span></p><p class="c2"><span>% &nbsp; The additional input argument OS determines which outputs of the</span></p><p class="c2"><span>% &nbsp; analysis function are included. OS should be a numerical array indexing</span></p><p class="c2"><span>% &nbsp; into the output argument list of the analysis function (integers</span></p><p class="c2"><span>% &nbsp; between 1 and the number of FUNHANDLE output arguments - see NARGOUT).</span></p><p class="c2"><span>% &nbsp; The length of OS should match the number of inserted properties (i.e.</span></p><p class="c2"><span>% &nbsp; the length of PR).</span></p><p class="c2"><span>%</span></p><p class="c2"><span>% &nbsp; ADDANALYSIS(FUNHANDLE,&#39;PROPERTY_NAMES&#39;,PR,&#39;OUTPUT_SUBSET&#39;,OS,&#39;MANDATORY&#39;,ARGM,&#39;ARGLIST&#39;,ARGVAL)</span></p><p class="c2"><span>% &nbsp; also passes input arguments to FUNHANDLE. Mandatory arguments should be</span></p><p class="c2"><span>% &nbsp; passed in ARGM and parameter-value pairs should be specified in ARGVAL</span></p><p class="c2"><span>% &nbsp; (N-by-2 cell array). These are be passed on to the analysis function.</span></p><p class="c2"><span>%</span></p><p class="c2"><span>% &nbsp; Examples:</span></p><p class="c2"><span>% &nbsp; addanalysis(@LRatio2,&#39;property_names&#39;,{&#39;ID_PC&#39;,&#39;Lr_PC&#39;},&#39;arglist&#39;,{&#39;fea</span></p><p class="c2"><span>% &nbsp; ture_names&#39; {&#39;WavePC1&#39; &#39;Energy&#39;}})</span></p><p class="c2"><span>%</span></p><p class="c2"><span>% &nbsp; addanalysis(@ultimate_psth,...</span></p><p class="c2"><span>% &nbsp; &#39;mandatory&#39;,{&#39;trial&#39; @findAlignEvent_negfeedback_gonogo [-0.6 0.6]},...</span></p><p class="c2"><span>% &nbsp; &#39;property_names&#39;,{&#39;FA_psth&#39; &#39;FA_psth_stats&#39;},&#39;output_subset&#39;,[1 6],...</span></p><p class="c2"><span>% &nbsp; &#39;arglist&#39;,{&#39;dt&#39;,0.001;&#39;display&#39;,false;&#39;sigma&#39;,0.02;&#39;parts&#39;,&#39;all&#39;;&#39;isadaptive&#39;,2;...</span></p><p class="c2"><span>% &nbsp; &#39;event_filter&#39;,&#39;custom&#39;;&#39;filterinput&#39;,&#39;FalseAlarm==1&#39;;&#39;maxtrialno&#39;,Inf;...</span></p><p class="c2"><span>% &nbsp; &#39;baselinewin&#39;,[-0.5 0];&#39;testwin&#39;,[0 0.5];&#39;relative_threshold&#39;,0.1});</span></p><p class="c2"><span>%</span></p><p class="c2"><span>% &nbsp; See also FINDANALYSIS.</span></p><p class="c3 c2"><span></span></p><h1 class="c2"><a name="h.y5cykclw4219"></a><span>7/15/13, BH: findstimperiod.m</span></h1><p class="c2"><span class="c1">updated with input parser and renamed findStimPeriod </span></p><p class="c2"><span class="c1">bug fixed: activation time returned in sec now (did not affect other programs, this output was never used)</span></p><p class="c2"><span class="c1">minor change: margin excluded from baseline prob. (should have at max negliable effects on nbtaggedprop)</span></p><p class="c2"><span class="c1">however, the following call makes findStimPeriod obsolete:</span></p><p class="c3 c2"><span></span></p><p class="c2"><span>[psth, spsth, ~, ~, spt, stats] = ultimate_psth(cellid,&#39;stim&#39;,g.event,[-0.005 0.01],...</span></p><p class="c2 c7"><span>&#39;dt&#39;,0.0005,&#39;display&#39;,false,&#39;isadaptive&#39;,1,&#39;maxtrialno&#39;,Inf,...</span></p><p class="c2 c7"><span>&#39;event_filter&#39;,g.event_filter,&#39;filterinput&#39;,g.filterinput,...</span></p><p class="c2 c7"><span>&#39;baselinewin&#39;,[-0.005 0],&#39;testwin&#39;,[0 0.01],&#39;relative_threshold&#39;,0.5,&#39;margin&#39;,[0 0]);</span></p><p class="c2"><span>lim1 = stats.activation_start; &nbsp;% window start for evoked spikes</span></p><p class="c2"><span>lim2 = stats.activation_end; &nbsp; % window end for evoked spikes</span></p><p class="c2"><span>L = stats.activation_peak; &nbsp; % LATENCY</span></p><p class="c2"><span>at = stats.activation_time;</span></p><p class="c2"><span>M = stats.maxvalue;</span></p><p class="c2"><span>B = stats.baseline;</span></p><p class="c3 c2"><span></span></p><p class="c2"><span class="c1">- new syntax is slightly slower (on an example cell, 1.74 s vs 1.56 s)</span></p><p class="c2"><span class="c1">- new syntax has more options, e.g. it is easy to use doubly adaptive PSTH</span></p><p class="c3 c2"><span></span></p><h1 class="c2"><a name="h.j73hf71xx9dt"></a><span>7/15/13, BH: psth_stats.m</span></h1><p class="c2"><span class="c1">error handling; warning if MW-test skipped due to short baseline</span></p><p class="c2"><span class="c1">changed window definitions to exlculde first point from baseline and last from test; this way it&rsquo;s easy to avoid indexing issues</span></p><p class="c2"><span class="c1">should have only negligible effects on nbtaggedprop</span></p><p class="c3 c2"><span class="c1"></span></p><h1 class="c2"><a name="h.kp5ldhjmxwq6"></a><span>7/18/13, BH: formatforExcel.m</span></h1><p class="c2"><span class="c1">bug fixing</span></p><p class="c2"><span class="c1">replacement of Infs and NaNs was crashing on empty elements of TheMatrix</span></p></body></html>